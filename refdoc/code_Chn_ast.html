<html><head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of exceptions" rel=Appendix href="index_exceptions.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of class attributes" rel=Appendix href="index_attributes.html">
<link title="Index of class methods" rel=Appendix href="index_methods.html">
<link title="Index of classes" rel=Appendix href="index_classes.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Index of module types" rel=Appendix href="index_module_types.html">
<link title="Checks" rel="Chapter" href="Checks.html">
<link title="Chn_ast" rel="Chapter" href="Chn_ast.html">
<link title="Chn_diff" rel="Chapter" href="Chn_diff.html">
<link title="Chn_exec" rel="Chapter" href="Chn_exec.html">
<link title="Chn_flat" rel="Chapter" href="Chn_flat.html">
<link title="Chn_inst" rel="Chapter" href="Chn_inst.html">
<link title="Chn_inst_query" rel="Chapter" href="Chn_inst_query.html">
<link title="Chn_io" rel="Chapter" href="Chn_io.html">
<link title="Chn_lookup" rel="Chapter" href="Chn_lookup.html">
<link title="Chn_parser" rel="Chapter" href="Chn_parser.html">
<link title="Chn_run" rel="Chapter" href="Chn_run.html">
<link title="Chn_types" rel="Chapter" href="Chn_types.html">
<link title="Chngui" rel="Chapter" href="Chngui.html">
<link title="Cmdline" rel="Chapter" href="Cmdline.html">
<link title="Config" rel="Chapter" href="Config.html">
<link title="Find" rel="Chapter" href="Find.html">
<link title="Graph" rel="Chapter" href="Graph.html">
<link title="Grdf_branch" rel="Chapter" href="Grdf_branch.html">
<link title="Grdf_constant" rel="Chapter" href="Grdf_constant.html">
<link title="Grdf_dot" rel="Chapter" href="Grdf_dot.html">
<link title="Grdf_ftype" rel="Chapter" href="Grdf_ftype.html">
<link title="Grdf_init" rel="Chapter" href="Grdf_init.html">
<link title="Grdf_intf" rel="Chapter" href="Grdf_intf.html">
<link title="Grdf_parser" rel="Chapter" href="Grdf_parser.html">
<link title="Grdf_port" rel="Chapter" href="Grdf_port.html">
<link title="Grdf_tool" rel="Chapter" href="Grdf_tool.html">
<link title="Grdf_types" rel="Chapter" href="Grdf_types.html">
<link title="Grdf_version" rel="Chapter" href="Grdf_version.html">
<link title="Grdfs" rel="Chapter" href="Grdfs.html">
<link title="Gui_base" rel="Chapter" href="Gui_base.html">
<link title="Gui_install" rel="Chapter" href="Gui_install.html">
<link title="Gui_main" rel="Chapter" href="Gui_main.html">
<link title="Ind_io" rel="Chapter" href="Ind_io.html">
<link title="Ind_types" rel="Chapter" href="Ind_types.html">
<link title="Install" rel="Chapter" href="Install.html">
<link title="Instgui" rel="Chapter" href="Instgui.html">
<link title="Lexer" rel="Chapter" href="Lexer.html">
<link title="Loc" rel="Chapter" href="Loc.html">
<link title="Main" rel="Chapter" href="Main.html">
<link title="Main_chain" rel="Chapter" href="Main_chain.html">
<link title="Main_cheat" rel="Chapter" href="Main_cheat.html">
<link title="Main_cmd" rel="Chapter" href="Main_cmd.html">
<link title="Main_diff" rel="Chapter" href="Main_diff.html">
<link title="Main_edit" rel="Chapter" href="Main_edit.html">
<link title="Main_exec" rel="Chapter" href="Main_exec.html">
<link title="Main_genrdfs" rel="Chapter" href="Main_genrdfs.html">
<link title="Main_gui" rel="Chapter" href="Main_gui.html">
<link title="Main_init" rel="Chapter" href="Main_init.html">
<link title="Main_query" rel="Chapter" href="Main_query.html">
<link title="Main_rdf" rel="Chapter" href="Main_rdf.html">
<link title="Main_rest" rel="Chapter" href="Main_rest.html">
<link title="Misc" rel="Chapter" href="Misc.html">
<link title="Options" rel="Chapter" href="Options.html">
<link title="Rdf_sparql" rel="Chapter" href="Rdf_sparql.html">
<link title="Reporter" rel="Chapter" href="Reporter.html">
<link title="Rest_query" rel="Chapter" href="Rest_query.html">
<link title="Rest_types" rel="Chapter" href="Rest_types.html">
<link title="Rest_xhtml" rel="Chapter" href="Rest_xhtml.html">
<link title="Rest_xpage" rel="Chapter" href="Rest_xpage.html">
<link title="Smap" rel="Chapter" href="Smap.html">
<link title="Sset" rel="Chapter" href="Sset.html">
<link title="Tokens" rel="Chapter" href="Tokens.html">
<link title="Toolgui" rel="Chapter" href="Toolgui.html">
<link title="Urimap" rel="Chapter" href="Urimap.html">
<link title="Uriset" rel="Chapter" href="Uriset.html">
<link title="Version" rel="Chapter" href="Version.html"><title>Genet library reference : Chn_ast</title>
</head>
<body>
<code class="code"></code><table><tr><td></td><td><span class="comment">(*********************************************************************************)</span></td></tr></table><code class="code"><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Genet&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;Copyright&nbsp;(C)&nbsp;2012-2013&nbsp;Institut&nbsp;National&nbsp;de&nbsp;Recherche&nbsp;en&nbsp;Informatique&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;et&nbsp;en&nbsp;Automatique.&nbsp;All&nbsp;rights&nbsp;reserved.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;program&nbsp;is&nbsp;free&nbsp;software;&nbsp;you&nbsp;can&nbsp;redistribute&nbsp;it&nbsp;and/or&nbsp;modify&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;under&nbsp;the&nbsp;terms&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;version&nbsp;3&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;or&nbsp;later&nbsp;as&nbsp;published&nbsp;by&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;This&nbsp;program&nbsp;is&nbsp;distributed&nbsp;in&nbsp;the&nbsp;hope&nbsp;that&nbsp;it&nbsp;will&nbsp;be&nbsp;useful,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;WITHOUT&nbsp;ANY&nbsp;WARRANTY;&nbsp;without&nbsp;even&nbsp;the&nbsp;implied&nbsp;warranty&nbsp;of&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;MERCHANTABILITY&nbsp;or&nbsp;FITNESS&nbsp;FOR&nbsp;A&nbsp;PARTICULAR&nbsp;PURPOSE.&nbsp;&nbsp;See&nbsp;the&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;for&nbsp;more&nbsp;details.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;You&nbsp;should&nbsp;have&nbsp;received&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;GNU&nbsp;General&nbsp;Public&nbsp;License&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;along&nbsp;with&nbsp;this&nbsp;program;&nbsp;if&nbsp;not,&nbsp;write&nbsp;to&nbsp;the&nbsp;Free&nbsp;Software&nbsp;Foundation,&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;Inc.,&nbsp;59&nbsp;Temple&nbsp;Place,&nbsp;Suite&nbsp;330,&nbsp;Boston,&nbsp;MA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;02111-1307&nbsp;&nbsp;USA&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;Contact:&nbsp;Maxence.Guesdon@inria.fr&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
<span class="comment">(*&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;*)</span><br>
</code><table><tr><td></td><td><span class="comment">(*********************************************************************************)</span></td></tr></table><code class="code"><br>
<br>
</code><table><tr><td></td><td><span class="comment">(** *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">open</span>&nbsp;<span class="constructor">Chn_types</span>;;<br>
<br>
<span class="keyword">type</span>&nbsp;operation_name&nbsp;=&nbsp;string<br>
<span class="keyword">type</span>&nbsp;port_name&nbsp;=&nbsp;string<br>
<br>
<span class="keyword">type</span>&nbsp;port&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;p_name&nbsp;:&nbsp;port_name&nbsp;;<br>
&nbsp;&nbsp;p_loc&nbsp;:&nbsp;<span class="constructor">Loc</span>.t&nbsp;;<br>
&nbsp;&nbsp;p_ftype&nbsp;:&nbsp;string&nbsp;<span class="constructor">Grdf_types</span>.port_type&nbsp;;<br>
}<br>
<br>
<br>
<span class="keyword">type</span>&nbsp;port_ref&nbsp;=&nbsp;<span class="constructor">Pint</span>&nbsp;<span class="keyword">of</span>&nbsp;int&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Pname</span>&nbsp;<span class="keyword">of</span>&nbsp;port_name<br>
<span class="keyword">type</span>&nbsp;edge_part&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;ep_op&nbsp;:&nbsp;operation_name&nbsp;option&nbsp;;<br>
&nbsp;&nbsp;ep_port&nbsp;:&nbsp;port_ref&nbsp;;<br>
&nbsp;&nbsp;ep_loc&nbsp;:&nbsp;<span class="constructor">Loc</span>.t&nbsp;;<br>
&nbsp;&nbsp;}<br>
<br>
<span class="keyword">type</span>&nbsp;edge&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;edge_src&nbsp;:&nbsp;edge_part&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;edge_dst&nbsp;:&nbsp;edge_part&nbsp;;<br>
&nbsp;&nbsp;}<br>
<br>
<span class="keyword">type</span>&nbsp;special&nbsp;=<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Explode</span>&nbsp;<span class="keyword">of</span>&nbsp;operation_name&nbsp;*&nbsp;op_origin&nbsp;*&nbsp;port_ref<br>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** the operation name is needed in flattening *)</span></td></tr></table><code class="code"><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Implode</span>&nbsp;<span class="keyword">of</span>&nbsp;operation_name&nbsp;*&nbsp;op_origin&nbsp;*&nbsp;port_ref<br>
&nbsp;&nbsp;&nbsp;&nbsp;</code><table><tr><td>&nbsp;&nbsp;&nbsp;&nbsp;</td><td><span class="comment">(** the operation name is needed in flattening *)</span></td></tr></table><code class="code"><br>
<br>
<span class="keyword">and</span>&nbsp;op_origin&nbsp;=<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Chain</span>&nbsp;<span class="keyword">of</span>&nbsp;chain_name<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;<span class="keyword">of</span>&nbsp;string<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;<span class="keyword">of</span>&nbsp;op_origin&nbsp;*&nbsp;port_ref<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;<span class="keyword">of</span>&nbsp;special<br>
<br>
<span class="keyword">type</span>&nbsp;operation&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;op_name&nbsp;:&nbsp;operation_name&nbsp;;<br>
&nbsp;&nbsp;op_loc&nbsp;:&nbsp;<span class="constructor">Loc</span>.t&nbsp;;<br>
&nbsp;&nbsp;op_from&nbsp;:&nbsp;op_origin&nbsp;;<br>
&nbsp;&nbsp;op_from_loc&nbsp;:&nbsp;<span class="constructor">Loc</span>.t&nbsp;;<br>
}<br>
<br>
<span class="keyword">type</span>&nbsp;chain&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;chn_name&nbsp;:&nbsp;chain_basename&nbsp;;<br>
&nbsp;&nbsp;chn_loc&nbsp;:&nbsp;<span class="constructor">Loc</span>.t&nbsp;;<br>
&nbsp;&nbsp;chn_comment&nbsp;:&nbsp;string&nbsp;;<br>
&nbsp;&nbsp;chn_inputs&nbsp;:&nbsp;port&nbsp;array&nbsp;;<br>
&nbsp;&nbsp;chn_outputs&nbsp;:&nbsp;port&nbsp;array&nbsp;;<br>
&nbsp;&nbsp;chn_ops&nbsp;:&nbsp;operation&nbsp;list&nbsp;;<br>
&nbsp;&nbsp;chn_edges&nbsp;:&nbsp;edge&nbsp;list&nbsp;;<br>
}<br>
<br>
<span class="keyword">type</span>&nbsp;chn_module&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;cmod_name&nbsp;:&nbsp;<span class="constructor">Chn_types</span>.chain_modname&nbsp;;<br>
&nbsp;&nbsp;cmod_chains&nbsp;:&nbsp;chain&nbsp;list&nbsp;;<br>
&nbsp;&nbsp;}<br>
<br>
<span class="keyword">let</span>&nbsp;get_chain&nbsp;cmod&nbsp;basename&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;chn&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.find<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">fun</span>&nbsp;chn&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_types</span>.compare_chain_basename&nbsp;chn.chn_name&nbsp;basename&nbsp;=&nbsp;0)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cmod.cmod_chains<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Some</span>&nbsp;chn<br>
&nbsp;&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Not_found</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">None</span><br>
;;<br>
<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Chn_ord_type</span>&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">struct</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">type</span>&nbsp;t&nbsp;=&nbsp;<span class="constructor">Chn_types</span>.chain_name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;compare&nbsp;=&nbsp;<span class="constructor">Chn_types</span>.compare_chain_name<br>
&nbsp;&nbsp;&nbsp;<span class="keyword">end</span>;;<br>
<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Cset</span>&nbsp;=&nbsp;<span class="constructor">Set</span>.<span class="constructor">Make</span>(<span class="constructor">Chn_ord_type</span>);;<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Cmap</span>&nbsp;=&nbsp;<span class="constructor">Map</span>.<span class="constructor">Make</span>(<span class="constructor">Chn_ord_type</span>);;<br>
<br>
<span class="keyword">type</span>&nbsp;chain_deps&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;dep_chn&nbsp;:&nbsp;chain&nbsp;;<br>
&nbsp;&nbsp;dep_intfs&nbsp;:&nbsp;<span class="constructor">Sset</span>.t&nbsp;;&nbsp;<span class="comment">(*&nbsp;interfaces&nbsp;(in&nbsp;the&nbsp;form&nbsp;"/tool/intf")&nbsp;a&nbsp;chain&nbsp;depends&nbsp;on&nbsp;*)</span><br>
&nbsp;&nbsp;dep_chains&nbsp;:&nbsp;<span class="constructor">Cset</span>.t&nbsp;;&nbsp;<span class="comment">(*&nbsp;chains&nbsp;a&nbsp;chain&nbsp;depends&nbsp;on&nbsp;*)</span><br>
&nbsp;&nbsp;dep_unknown&nbsp;:&nbsp;op_origin&nbsp;list&nbsp;;&nbsp;<span class="comment">(*&nbsp;unknown&nbsp;origins&nbsp;the&nbsp;chain&nbsp;refers&nbsp;to&nbsp;*)</span><br>
};;<br>
<span class="keyword">let</span>&nbsp;empty_chain_deps&nbsp;chn&nbsp;=<br>
&nbsp;&nbsp;{&nbsp;dep_chn&nbsp;=&nbsp;chn&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dep_intfs&nbsp;=&nbsp;<span class="constructor">Sset</span>.empty&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dep_chains&nbsp;=&nbsp;<span class="constructor">Cset</span>.empty&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;dep_unknown&nbsp;=&nbsp;[]&nbsp;;<br>
&nbsp;&nbsp;};;<br>
<br>
<span class="keyword">type</span>&nbsp;deps&nbsp;=&nbsp;chain_deps&nbsp;<span class="constructor">Cmap</span>.t&nbsp;;;<br>
<br>
<span class="keyword">let</span>&nbsp;compute_deps&nbsp;wld&nbsp;config&nbsp;cmods&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_chn&nbsp;modname&nbsp;map&nbsp;chn&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Cmap</span>.add<br>
&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Chn_types</span>.mk_chain_name&nbsp;modname&nbsp;chn.chn_name)&nbsp;(empty_chain_deps&nbsp;chn)<br>
&nbsp;&nbsp;&nbsp;&nbsp;map<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_cmod&nbsp;map&nbsp;cmod&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.fold_left&nbsp;(f_chn&nbsp;cmod.cmod_name)&nbsp;map&nbsp;cmod.cmod_chains<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;map&nbsp;=&nbsp;<span class="constructor">List</span>.fold_left&nbsp;f_cmod&nbsp;<span class="constructor">Cmap</span>.empty&nbsp;cmods&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;iter_origin&nbsp;d&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;uri&nbsp;=&nbsp;<span class="constructor">Chn_types</span>.uri_intf_of_interface_spec&nbsp;~prefix:&nbsp;config.<span class="constructor">Config</span>.rest_api&nbsp;s&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;<span class="constructor">Grdf_intf</span>.intf_exists&nbsp;wld&nbsp;uri&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Some</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;{&nbsp;d&nbsp;<span class="keyword">with</span>&nbsp;dep_intfs&nbsp;=&nbsp;<span class="constructor">Sset</span>.add&nbsp;s&nbsp;d.dep_intfs&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;raise&nbsp;<span class="constructor">Not_found</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;d&nbsp;<span class="keyword">with</span>&nbsp;dep_unknown&nbsp;=&nbsp;(<span class="constructor">Interface</span>&nbsp;s)&nbsp;::&nbsp;d.dep_unknown&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Chain</span>&nbsp;fullname&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">begin</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">try</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ignore(<span class="constructor">Cmap</span>.find&nbsp;fullname&nbsp;map);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;d&nbsp;<span class="keyword">with</span>&nbsp;dep_chains&nbsp;=&nbsp;<span class="constructor">Cset</span>.add&nbsp;fullname&nbsp;d.dep_chains&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">Not_found</span>&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;d&nbsp;<span class="keyword">with</span>&nbsp;dep_unknown&nbsp;=&nbsp;(<span class="constructor">Chain</span>&nbsp;fullname)&nbsp;::&nbsp;d.dep_unknown&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">end</span><br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;iter_origin&nbsp;d&nbsp;origin<br>
&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span><br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_origin&nbsp;d&nbsp;op&nbsp;=&nbsp;iter_origin&nbsp;d&nbsp;op.op_from&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f_chn&nbsp;fullname&nbsp;d&nbsp;map&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;d&nbsp;=&nbsp;<span class="constructor">List</span>.fold_left&nbsp;f_origin&nbsp;d&nbsp;d.dep_chn.chn_ops&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Cmap</span>.add&nbsp;fullname&nbsp;d&nbsp;map<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Cmap</span>.fold&nbsp;f_chn&nbsp;map&nbsp;map<br>
;;<br>
<br>
<span class="keyword">module</span>&nbsp;<span class="constructor">Chn_graph</span>&nbsp;=&nbsp;<span class="constructor">Graph</span>.<span class="constructor">Make_with_map</span><br>
&nbsp;&nbsp;(<span class="constructor">Chn_ord_type</span>)(<span class="keyword">struct</span>&nbsp;<span class="keyword">type</span>&nbsp;t&nbsp;=&nbsp;unit&nbsp;<span class="keyword">let</span>&nbsp;compare&nbsp;=&nbsp;<span class="constructor">Pervasives</span>.compare&nbsp;<span class="keyword">end</span>);;<br>
<br>
<span class="keyword">let</span>&nbsp;compute_dep_graph&nbsp;deps&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;<span class="keyword">rec</span>&nbsp;f&nbsp;chain_name&nbsp;dep&nbsp;g&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Cset</span>.fold&nbsp;(<span class="keyword">fun</span>&nbsp;name&nbsp;g&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_graph</span>.add&nbsp;g&nbsp;(chain_name,&nbsp;name,&nbsp;()))<br>
&nbsp;&nbsp;&nbsp;&nbsp;dep.dep_chains&nbsp;g<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="constructor">Cmap</span>.fold&nbsp;f&nbsp;deps&nbsp;(<span class="constructor">Chn_graph</span>.create())<br>
;;<br>
<br>
<span class="keyword">class</span>&nbsp;ast_printer&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">object</span>(self)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port_type&nbsp;=&nbsp;<span class="constructor">Grdf_port</span>.string_of_port_type&nbsp;(<span class="keyword">fun</span>&nbsp;x&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;x)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port&nbsp;p&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%s&nbsp;%s"</span>&nbsp;(self<span class="keywordsign">#</span>string_of_port_type&nbsp;p.p_ftype)&nbsp;p.p_name<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port_array&nbsp;l&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;l&nbsp;=&nbsp;<span class="constructor">Array</span>.to_list&nbsp;l&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">String</span>.concat&nbsp;<span class="string">",&nbsp;"</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;self<span class="keywordsign">#</span>string_of_port&nbsp;l)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_op_origin&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chain</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_types</span>.string_of_chain_name&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;uri&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%S"</span>&nbsp;uri<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;port_ref)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"foreach(%s,&nbsp;%s)"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_op_origin&nbsp;origin)&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;port_ref)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_operation&nbsp;op&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"&nbsp;&nbsp;operation&nbsp;%s&nbsp;:&nbsp;%s&nbsp;;\n"</span>&nbsp;op.op_name<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_op_origin&nbsp;op.op_from)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_operation_list&nbsp;l&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">String</span>.concat&nbsp;<span class="string">""</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;self<span class="keywordsign">#</span>string_of_operation&nbsp;l)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port_ref&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Pint</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;string_of_int&nbsp;n<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Pname</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_edge&nbsp;e&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"&nbsp;&nbsp;%s%s&nbsp;-&gt;&nbsp;%s%s&nbsp;;\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">match</span>&nbsp;e.edge_src.ep_op&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s^<span class="string">"."</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;e.edge_src.ep_port)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">match</span>&nbsp;e.edge_dst.ep_op&nbsp;<span class="keyword">with</span>&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">""</span>&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s^<span class="string">"."</span>)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;e.edge_dst.ep_port)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_edge_list&nbsp;l&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">String</span>.concat&nbsp;<span class="string">""</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;self<span class="keywordsign">#</span>string_of_edge&nbsp;l)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_chain&nbsp;chn&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Buffer</span>.create&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"chain&nbsp;%s\n(*&nbsp;%s&nbsp;*)\n{\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Chn_types</span>.string_of_chain_basename&nbsp;chn.chn_name)&nbsp;chn.chn_comment&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"&nbsp;&nbsp;in:&nbsp;%s&nbsp;;\n"</span>&nbsp;(self<span class="keywordsign">#</span>string_of_port_array&nbsp;chn.chn_inputs)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"&nbsp;&nbsp;out:&nbsp;%s&nbsp;;\n"</span>&nbsp;(self<span class="keywordsign">#</span>string_of_port_array&nbsp;chn.chn_outputs)&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"\n%s"</span>&nbsp;(self<span class="keywordsign">#</span>string_of_operation_list&nbsp;chn.chn_ops);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"\n%s"</span>&nbsp;(self<span class="keywordsign">#</span>string_of_edge_list&nbsp;chn.chn_edges);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"}\n"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.contents&nbsp;b<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_chn_module&nbsp;cmod&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">String</span>.concat&nbsp;<span class="string">"\n"</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;self<span class="keywordsign">#</span>string_of_chain&nbsp;cmod.cmod_chains)<br>
<br>
&nbsp;&nbsp;<span class="keyword">end</span><br>
<br>
<span class="keyword">let</span>&nbsp;printer&nbsp;()&nbsp;=&nbsp;<span class="keyword">new</span>&nbsp;ast_printer&nbsp;;;<br>
<br>
<span class="keyword">class</span>&nbsp;chain_dot_printer&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">object</span>(self)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;color_in&nbsp;=&nbsp;<span class="string">"palegreen"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;color_out&nbsp;=&nbsp;<span class="string">"paleturquoise"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;color_chain&nbsp;=&nbsp;<span class="string">"grey75"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;color_interface&nbsp;=&nbsp;<span class="string">"lightsalmon"</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port_ref&nbsp;dir&nbsp;?(label=<span class="keyword">false</span>)&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Pint</span>&nbsp;n&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;label&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;string_of_int&nbsp;n<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%s_p%d"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">Grdf_port</span>.string_of_dir&nbsp;dir)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;n<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Pname</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;s<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_op_origin&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chain</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_types</span>.string_of_chain_name&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;uri&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%S"</span>&nbsp;uri<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;port_ref)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"foreach(%s,&nbsp;%s)"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_op_origin&nbsp;origin)&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;~label:&nbsp;<span class="keyword">true</span>&nbsp;<span class="constructor">Grdf_port</span>.<span class="constructor">In</span>&nbsp;port_ref)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;uri_of_op_origin&nbsp;prefix&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chain</span>&nbsp;s&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_types</span>.uri_chain&nbsp;prefix&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;uri&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Chn_types</span>.uri_intf_of_interface_spec&nbsp;~prefix&nbsp;uri<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;self<span class="keywordsign">#</span>uri_of_op_origin&nbsp;prefix&nbsp;origin<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;color_of_op_origin&nbsp;=&nbsp;<span class="keyword">function</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chain</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;self<span class="keywordsign">#</span>color_chain<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;self<span class="keywordsign">#</span>color_interface<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;self<span class="keywordsign">#</span>color_of_op_origin&nbsp;origin<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="keyword">assert</span>&nbsp;<span class="keyword">false</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_port&nbsp;dir&nbsp;color&nbsp;p&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"&lt;TR&gt;&lt;TD&nbsp;BGCOLOR=\"%s\"&nbsp;PORT=\"%s\"&gt;%s&lt;/TD&gt;&lt;/TR&gt;"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;dir&nbsp;p)&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;dir&nbsp;~label:&nbsp;<span class="keyword">true</span>&nbsp;p)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_operation&nbsp;?prefix&nbsp;b&nbsp;chn&nbsp;op&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;map&nbsp;acc&nbsp;edge&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;ep&nbsp;=&nbsp;map&nbsp;edge&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;ep.ep_op&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;name&nbsp;<span class="keyword">when</span>&nbsp;name&nbsp;=&nbsp;op.op_name&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;p&nbsp;=&nbsp;ep.ep_port&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;<span class="constructor">List</span>.mem&nbsp;p&nbsp;acc&nbsp;<span class="keyword">then</span>&nbsp;acc&nbsp;<span class="keyword">else</span>&nbsp;p&nbsp;::&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;_<span class="keywordsign">-&gt;</span>&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;get_ports&nbsp;map&nbsp;=&nbsp;<span class="constructor">List</span>.fold_left&nbsp;(f&nbsp;map)&nbsp;[]&nbsp;chn.chn_edges&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;inputs&nbsp;=&nbsp;get_ports&nbsp;(<span class="keyword">fun</span>&nbsp;edge&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;edge.edge_dst)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;outputs&nbsp;=&nbsp;get_ports&nbsp;(<span class="keyword">fun</span>&nbsp;edge&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;edge.edge_src)&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;bgcolor&nbsp;=&nbsp;self<span class="keywordsign">#</span>color_of_op_origin&nbsp;op.op_from&nbsp;<span class="keyword">in</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;string_of_ports&nbsp;dir&nbsp;color&nbsp;ports&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;&nbsp;<span class="string">"&lt;TD&gt;&lt;TABLE&nbsp;BORDER=\"0\"&nbsp;CELLBORDER=\"1\"&nbsp;CELLSPACING=\"3\"&nbsp;CELLPADDING=\"4\"&gt;%s&lt;/TABLE&gt;&lt;/TD&gt;"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="constructor">String</span>.concat&nbsp;<span class="string">""</span>&nbsp;(<span class="constructor">List</span>.map&nbsp;(self<span class="keywordsign">#</span>string_of_port&nbsp;dir&nbsp;color)&nbsp;ports))<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;[&nbsp;shape=plaintext&nbsp;label=&lt;&lt;TABLE&nbsp;BGCOLOR=\"%s\"&nbsp;BORDER=\"1\"&nbsp;CELLBORDER=\"0\"&nbsp;CELLSPACING=\"0\"&nbsp;CELLPADDING=\"3\"&gt;&lt;TR&gt;"</span>&nbsp;op.op_name&nbsp;bgcolor;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s"</span>&nbsp;(string_of_ports&nbsp;<span class="constructor">Grdf_port</span>.<span class="constructor">In</span>&nbsp;self<span class="keywordsign">#</span>color_in&nbsp;inputs);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"&lt;TD&nbsp;ALIGN=\"CENTER\"&nbsp;HREF=\"%s\"&nbsp;CELLPADDING=\"4\"&gt;%s&lt;/TD&gt;"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="keyword">match</span>&nbsp;prefix&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="string">""</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;prefix&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Rdf_uri</span>.string&nbsp;(self<span class="keywordsign">#</span>uri_of_op_origin&nbsp;prefix&nbsp;op.op_from)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_op_origin&nbsp;op.op_from);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s"</span>&nbsp;(string_of_ports&nbsp;<span class="constructor">Grdf_port</span>.<span class="constructor">Out</span>&nbsp;self<span class="keywordsign">#</span>color_out&nbsp;outputs);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"&lt;/TR&gt;&lt;/TABLE&gt;&gt;];\n"</span><br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;string_of_edge_part&nbsp;dir&nbsp;ep&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;ep.ep_op&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">None</span>&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;self<span class="keywordsign">#</span>string_of_port_ref&nbsp;dir&nbsp;ep.ep_port<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Some</span>&nbsp;op_name&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%s:%s"</span>&nbsp;op_name&nbsp;(self<span class="keywordsign">#</span>string_of_port_ref&nbsp;dir&nbsp;ep.ep_port)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_edge&nbsp;b&nbsp;edge&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;-&gt;&nbsp;%s&nbsp;;\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_edge_part&nbsp;<span class="constructor">Grdf_port</span>.<span class="constructor">Out</span>&nbsp;edge.edge_src)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>string_of_edge_part&nbsp;<span class="constructor">Grdf_port</span>.<span class="constructor">In</span>&nbsp;edge.edge_dst)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_port&nbsp;b&nbsp;color&nbsp;p&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;[color=\"black\"&nbsp;fillcolor=\"%s\"&nbsp;style=\"filled\"&nbsp;shape=\"box\"&nbsp;label=\"%s\"];\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;p.p_name&nbsp;color&nbsp;p.p_name<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;dot_of_chain&nbsp;?prefix&nbsp;chain&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Buffer</span>.create&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"digraph&nbsp;g&nbsp;{\nrankdir=LR;\nfontsize=10;\n"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_operation&nbsp;?prefix&nbsp;b&nbsp;chain)&nbsp;chain.chn_ops;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_edge&nbsp;b)&nbsp;chain.chn_edges;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_port&nbsp;b&nbsp;self<span class="keywordsign">#</span>color_in)&nbsp;chain.chn_inputs;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Array</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_port&nbsp;b&nbsp;self<span class="keywordsign">#</span>color_out)&nbsp;chain.chn_outputs;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"}\n"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.contents&nbsp;b<br>
<br>
&nbsp;&nbsp;<span class="keyword">end</span>;;<br>
<br>
<span class="keyword">class</span>&nbsp;chain_dot_deps&nbsp;?(chain_dot=<span class="keyword">new</span>&nbsp;chain_dot_printer)&nbsp;()&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">object</span>(self)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;id&nbsp;s&nbsp;=&nbsp;<span class="constructor">Printf</span>.sprintf&nbsp;<span class="string">"%S"</span>&nbsp;s<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;chain_id&nbsp;n&nbsp;=&nbsp;self<span class="keywordsign">#</span>id&nbsp;(<span class="constructor">Chn_types</span>.string_of_chain_name&nbsp;n)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;intf_id&nbsp;s&nbsp;=&nbsp;self<span class="keywordsign">#</span>id&nbsp;(<span class="constructor">String</span>.concat&nbsp;<span class="string">"___"</span>&nbsp;(<span class="constructor">Misc</span>.split_string&nbsp;s&nbsp;[<span class="string">'/'</span>]))<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_dep_chn&nbsp;b&nbsp;id&nbsp;fullname&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;-&gt;&nbsp;%s;\n"</span>&nbsp;id&nbsp;(self<span class="keywordsign">#</span>chain_id&nbsp;fullname)<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_dep_intf&nbsp;b&nbsp;id&nbsp;s&nbsp;intfs&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;-&gt;&nbsp;%s;\n"</span>&nbsp;id&nbsp;(self<span class="keywordsign">#</span>intf_id&nbsp;s);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sset</span>.add&nbsp;s&nbsp;intfs<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_chn&nbsp;b&nbsp;~prefix&nbsp;~fullnames&nbsp;fullname&nbsp;dep&nbsp;intfs&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;label&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;fullnames&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chn_types</span>.string_of_chain_name&nbsp;fullname<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Chn_types</span>.string_of_chain_basename&nbsp;(<span class="constructor">Chn_types</span>.chain_basename&nbsp;fullname)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;id&nbsp;=&nbsp;self<span class="keywordsign">#</span>chain_id&nbsp;fullname&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b&nbsp;<span class="string">"%s&nbsp;[label=\"%s\"&nbsp;shape=\"box\"&nbsp;href=\"%s\"&nbsp;style=\"filled\"&nbsp;fillcolor=\"%s\"];\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;id&nbsp;label&nbsp;(<span class="constructor">Rdf_uri</span>.string&nbsp;(<span class="constructor">Chn_types</span>.uri_chain&nbsp;prefix&nbsp;fullname))&nbsp;chain_dot<span class="keywordsign">#</span>color_chain;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Cset</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_dep_chn&nbsp;b&nbsp;id)&nbsp;dep.dep_chains&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;intfs&nbsp;=&nbsp;<span class="constructor">Sset</span>.fold&nbsp;(self<span class="keywordsign">#</span>print_dep_intf&nbsp;b&nbsp;id)&nbsp;dep.dep_intfs&nbsp;intfs&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;intfs<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;print_intf&nbsp;b&nbsp;~prefix&nbsp;intf&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;uri&nbsp;=&nbsp;<span class="constructor">Chn_types</span>.uri_intf_of_interface_spec&nbsp;~prefix&nbsp;intf&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Printf</span>.bprintf&nbsp;b<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="string">"%s&nbsp;[label=\"%s\"&nbsp;shape=\"box\"&nbsp;href=\"%s\"&nbsp;style=\"filled\"&nbsp;fillcolor=\"%s\"];\n"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(self<span class="keywordsign">#</span>intf_id&nbsp;intf)&nbsp;intf&nbsp;(<span class="constructor">Rdf_uri</span>.string&nbsp;uri)&nbsp;chain_dot<span class="keywordsign">#</span>color_interface<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">method</span>&nbsp;dot_of_deps&nbsp;prefix&nbsp;?(fullnames=<span class="keyword">true</span>)&nbsp;deps&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;b&nbsp;=&nbsp;<span class="constructor">Buffer</span>.create&nbsp;256&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"digraph&nbsp;g&nbsp;{\nrankdir=TB;\nfontsize=10;\n"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;intfs&nbsp;=&nbsp;<span class="constructor">Cmap</span>.fold&nbsp;(self<span class="keywordsign">#</span>print_chn&nbsp;b&nbsp;~prefix&nbsp;~fullnames)&nbsp;deps&nbsp;<span class="constructor">Sset</span>.empty&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Sset</span>.iter&nbsp;(self<span class="keywordsign">#</span>print_intf&nbsp;b&nbsp;~prefix)&nbsp;intfs;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">Buffer</span>.add_string&nbsp;b&nbsp;<span class="string">"}\n"</span>;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;dot&nbsp;=&nbsp;<span class="constructor">Buffer</span>.contents&nbsp;b&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*Misc.file_of_string&nbsp;~file:&nbsp;"/tmp/t.dot"&nbsp;dot;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dot<br>
&nbsp;&nbsp;<span class="keyword">end</span>;;<br>
<br>
<span class="keyword">let</span>&nbsp;flatten_foreaches&nbsp;ctx&nbsp;chn&nbsp;=<br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;pred&nbsp;name&nbsp;port&nbsp;ep&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;FIXME:&nbsp;handle&nbsp;both&nbsp;case&nbsp;Pint&nbsp;and&nbsp;Pname&nbsp;?&nbsp;*)</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;ep.ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;name&nbsp;<span class="keywordsign">&amp;&amp;</span>&nbsp;ep.ep_port&nbsp;=&nbsp;port<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;replace_in_port&nbsp;edges&nbsp;op_name&nbsp;op_port&nbsp;port&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;edge&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;pred&nbsp;op_name&nbsp;op_port&nbsp;edge.edge_dst&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;edge&nbsp;<span class="keyword">with</span>&nbsp;edge_dst&nbsp;=&nbsp;port&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.map&nbsp;f&nbsp;edges<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;replace_out_ports&nbsp;edges&nbsp;op_name&nbsp;op_name2&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;acc&nbsp;edge&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">if</span>&nbsp;edge.edge_src.ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;op_name&nbsp;<span class="keyword">then</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;edge2&nbsp;=&nbsp;{&nbsp;edge&nbsp;<span class="keyword">with</span>&nbsp;edge_src&nbsp;=&nbsp;{&nbsp;edge.edge_src&nbsp;<span class="keyword">with</span>&nbsp;ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;op_name2&nbsp;}&nbsp;}&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;acc&nbsp;=&nbsp;edge2&nbsp;::&nbsp;acc&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;acc&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge_src&nbsp;=&nbsp;edge.edge_src&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge_dst&nbsp;=&nbsp;edge2.edge_src&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;::&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">else</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge&nbsp;::&nbsp;acc<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="constructor">List</span>.fold_left&nbsp;f&nbsp;[]&nbsp;edges<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;f&nbsp;(ops,&nbsp;edges)&nbsp;op&nbsp;=<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">match</span>&nbsp;op.op_from&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Chain</span>&nbsp;_&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Interface</span>&nbsp;_<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Special</span>&nbsp;_&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;(op&nbsp;::&nbsp;ops,&nbsp;edges)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(<span class="constructor">Foreach</span>&nbsp;_,&nbsp;_)&nbsp;<span class="keywordsign">-&gt;</span>&nbsp;failwith&nbsp;<span class="string">"Nested&nbsp;foreach&nbsp;are&nbsp;not&nbsp;allowed"</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="keywordsign">|</span>&nbsp;<span class="constructor">Foreach</span>&nbsp;(origin,&nbsp;port_ref)&nbsp;<span class="keywordsign">-&gt;</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;op&nbsp;=&nbsp;{&nbsp;op&nbsp;<span class="keyword">with</span>&nbsp;op_from&nbsp;=&nbsp;origin&nbsp;}&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;explode&nbsp;=&nbsp;{&nbsp;op&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op_from&nbsp;=&nbsp;<span class="constructor">Special</span>&nbsp;(<span class="constructor">Explode</span>&nbsp;(op.op_name,&nbsp;origin,&nbsp;port_ref))&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op_name&nbsp;=&nbsp;op.op_name^<span class="string">"-explode"</span>}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;implode&nbsp;=&nbsp;{&nbsp;op&nbsp;<span class="keyword">with</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op_from&nbsp;=&nbsp;<span class="constructor">Special</span>&nbsp;(<span class="constructor">Implode</span>&nbsp;(op.op_name,&nbsp;origin,&nbsp;port_ref))&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;op_name&nbsp;=&nbsp;op.op_name^<span class="string">"-implode"</span>}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;explode_in&nbsp;=&nbsp;{&nbsp;ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;explode.op_name&nbsp;;&nbsp;ep_port&nbsp;=&nbsp;<span class="constructor">Pint</span>&nbsp;1&nbsp;;&nbsp;ep_loc&nbsp;=&nbsp;explode.op_loc&nbsp;}&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;explode_out&nbsp;=&nbsp;{&nbsp;ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;explode.op_name&nbsp;;&nbsp;ep_port&nbsp;=&nbsp;<span class="constructor">Pint</span>&nbsp;1&nbsp;;&nbsp;ep_loc&nbsp;=&nbsp;explode.op_loc&nbsp;}&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;edges&nbsp;=&nbsp;replace_in_port&nbsp;edges&nbsp;op.op_name&nbsp;port_ref&nbsp;explode_in&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;edges&nbsp;=&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge_src&nbsp;=&nbsp;explode_out&nbsp;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge_dst&nbsp;=&nbsp;{&nbsp;ep_op&nbsp;=&nbsp;<span class="constructor">Some</span>&nbsp;op.op_name&nbsp;;&nbsp;ep_port&nbsp;=&nbsp;port_ref&nbsp;;&nbsp;ep_loc&nbsp;=&nbsp;explode.op_loc&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;::&nbsp;edges<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;edges&nbsp;=&nbsp;replace_out_ports&nbsp;edges&nbsp;op.op_name&nbsp;implode.op_name&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(op&nbsp;::&nbsp;explode&nbsp;::&nbsp;implode&nbsp;::&nbsp;ops,&nbsp;edges)<br>
&nbsp;&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;<span class="keyword">let</span>&nbsp;(ops,&nbsp;edges)&nbsp;=&nbsp;<span class="constructor">List</span>.fold_left&nbsp;f&nbsp;([],&nbsp;chn.chn_edges)&nbsp;chn.chn_ops&nbsp;<span class="keyword">in</span><br>
&nbsp;&nbsp;{&nbsp;chn&nbsp;<span class="keyword">with</span>&nbsp;chn_ops&nbsp;=&nbsp;ops&nbsp;;&nbsp;chn_edges&nbsp;=&nbsp;edges&nbsp;}<br>
;;<br>
</code></body></html>