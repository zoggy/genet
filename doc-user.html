<!DOCTYPE HTML>
<html>
<head>
<title>Genet : User documentation</title><meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
<link href="http://zoggy.github.io/genet/style.css" rel="stylesheet" type="text/css"/>
<rssfeed></rssfeed>
</head><body>
<div id="page">
<div class="navbar navbar-fixed-top">
<div class="navbar-inner">
<div class="container">

  <div class="nav-collapse">
  <ul class="nav">
    <li class="&lt;navbar-home/&gt;"><a href="http://zoggy.github.io/genet">Genet</a></li>
    <li class="&lt;navbar-shots/&gt;"><a href="http://zoggy.github.io/genet/screenshots.html">Screenshots</a></li>
    <li class="&lt;navbar-download/&gt;"><a href="http://zoggy.github.io/genet/download.html">Download</a></li>
    <li class="active"><a href="http://zoggy.github.io/genet/doc.html">Documentation</a></li>
    <li class="&lt;navbar-blog/&gt;"><a href="http://zoggy.github.io/genet/blog.html">Blog</a></li>
    <li class="&lt;navbar-about/&gt;"><a href="http://zoggy.github.io/genet/about.html">?</a></li>
  </ul>
  </div>
  <div class="nav pull-right">

  </div>
</div>
</div>
</div>

<div id="header">

<div class="page-title">User documentation</div>
</div>
<span></span>


<p>
This is a very short introduction to the use of Genet.
</p>

Table of contents<ul class="toc"><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#setup">Set up a new project</a><ul class="toc"><li class="toc-subsection"><a href="http://zoggy.github.io/genet/doc-user.html#setup%3Ainit-dir">Create your project directory</a></li><li class="toc-subsection"><a href="http://zoggy.github.io/genet/doc-user.html#setup%3Aconfig-file">Edit the configuration file</a></li><li class="toc-subsection"><a href="http://zoggy.github.io/genet/doc-user.html#setup%3Acreate-db">Create the database</a></li><li class="toc-subsection"><a href="http://zoggy.github.io/genet/doc-user.html#setup%3Ainit-db">Initialize the database</a></li></ul></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#server">Launch the web server</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#filetypes">Define filetypes</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#tools">Define tools, branches, versions, intefaces</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#chains">Define treatment chains</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#inputs">Define inputs</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#flattening">Flatten chains</a></li><li class="toc-section"><a href="http://zoggy.github.io/genet/doc-user.html#executing">Execute chains</a></li></ul>
<div class="alert alert-warning">
We assume Genet was correctly installed (see <a href="http://zoggy.github.io/genet/doc-install.html">Installation</a>)
and the various <span class="icode">genet</span> tools are in your <span class="icode">PATH</span>.
</div>

<div class="section"><div class="section-title" id="setup">Set up a new project</div>
<div class="subsection"><div class="subsection-title" id="setup:init-dir">Create your project directory</div>
<p>
All data of your Genet project will reside in a single directory, with
the following structure:
</p>
<ul>
<li><span class="icode">out/</span>: will contains the results files.</li>
<li><span class="icode">in/</span>: a git repository that will contain all that the system
needs to compute results, in addition to the contents of the database;
  <ul>
  <li><span class="icode">chains/</span>: the description of execution chains.</li>
  <li><span class="icode">data/</span>: the examples and test cases the chains will be applied on.</li>
  <li><span class="icode">web/</span>: the directory containing web files:
    <ul>
    <li><span class="icode">tmpl/</span>: the template directory.</li>
    <li><span class="icode">style.css</span>: the CSS stylesheet.</li>
    <li>other files needed, like images, ...</li>
    </ul>
  </li>
  </ul>
</li>
<li><span class="icode">config.txt</span>: the configuration file describing the project,
  including database access information.</li>
</ul>
<p>
The following command can create this directory struture (if no
<span class="icode">[directory]</span> is provided, the structure is created in
the current directory):
<pre class="code-sh">$ genet init<span class="hl opt">-</span>dir <span class="hl opt">[</span>directory<span class="hl opt">]</span></pre>
</p>
<p>
If the <span class="icode">in</span> directory will be a git clone, you can specify
the git repository to clone with the <span class="icode">-git</span> option:
<pre class="code-sh">$ genet init<span class="hl opt">-</span>dir <span class="hl opt">-</span>git git@foo.bar<span class="hl opt">:</span>my<span class="hl opt">/</span>git<span class="hl opt">/</span>respository.git <span class="hl opt">[</span>directory<span class="hl opt">]</span></pre>
Required directories in the cloned repository are not created by the tool.
</p>
</div>

<div class="subsection"><div class="subsection-title" id="setup:config-file">Edit the configuration file</div>
<p>
The generated configuration file has the following form:
<pre class="code-ocaml">project_name <span class="hl opt">=</span> <span class="hl kwd">Foo</span>
project_id <span class="hl opt">=</span> foo
db <span class="hl opt">= {</span>
  <span class="hl com">(* postgresql or mysql[2] *)</span>
  storage <span class="hl opt">=</span> mysql
  name <span class="hl opt">=</span> genet
  user <span class="hl opt">=</span> genet
  host <span class="hl opt">=</span> localhost
  password <span class="hl opt">=</span> <span class="hl str">&quot;&quot;</span>
<span class="hl opt">}</span>
<span class="hl com">(* do not forget ending / *)</span>
rest_api <span class="hl opt">=</span> <span class="hl str">&quot;http://localhost:8082/&quot;</span></pre>
Edit the generated file and adapt it to your project.
</p>
</div>

<div class="subsection"><div class="subsection-title" id="setup:create-db">Create the database</div>
<p>Genet uses a database to store a part of its information.</p>
<p>
You must now create the database you will use, that is the one
you indicated in <a href="#setup:config-file">the configuration file</a>.
Do not forget to give read and write permissions on the database to
the user specified in the configuration file.
</p>
<p>
With mysql as database backend:
<pre class="code-sh">$ mysql <span class="hl opt">-</span>u root <span class="hl opt">-</span>p
mysql<span class="hl opt">&gt;</span> create database <span class="hl opt">&lt;</span>db<span class="hl opt">&gt;;</span>
mysql<span class="hl opt">&gt;</span> grant all privileges on <span class="hl opt">&lt;</span>db<span class="hl opt">&gt;</span>.<span class="hl opt">*</span> to <span class="hl opt">&lt;</span>dbuser<span class="hl opt">&gt;</span>@localhost identified by <span class="hl str">&quot;&lt;dbpasswd&gt;&quot;</span><span class="hl opt">;</span></pre>
</p>

</div>

<div class="subsection"><div class="subsection-title" id="setup:init-db">Initialize the database</div>
<p>
<pre class="code-sh">$ genet init<span class="hl opt">-</span>db</pre>
</p>
<p>
If the configuration file is not <span class="icode">config.txt</span>, you can specify
another with the <span class="icode">--config</span> option:
<pre class="code-sh">$ genet init<span class="hl opt">-</span>db <span class="hl opt">--</span>config myfile.txt</pre>
</p>
</div>
</div>

<div class="section"><div class="section-title" id="server">Launch the web server</div>
<p>
Genet comes with a web server to browse the various elements defined
(tools, branches, filetypes, chains, results, ..., see the next sections below).
</p>
<p>
To launch the server, use the following command:
</p>
<pre class="code-sh">$ genet<span class="hl opt">-</span>rest <span class="hl opt">[--</span>config <span class="hl opt">/</span>path<span class="hl opt">/</span>to<span class="hl opt">/</span>your<span class="hl opt">/</span>project<span class="hl opt">/</span>config.txt<span class="hl opt">]</span></pre>
<p>
The port to listen to is obtained from the <span class="icode">rest_api</span> field of
your project configuration file.
</p>
</div>
<div class="section"><div class="section-title" id="filetypes">Define filetypes</div>
<p>
The treatment chains will operate on files. To ensure that a file
of one type, produced by a command, will not be consumed by
another command reading files of another type, ports of
interfaces (see below) have to be typed. So you have to define the filetypes
you will use. Moreover, the way to compare two files can depend on their filetype.
</p>
<p>
To define a filetype, use <span class="icode">genet</span> in the root directory of your project,
where the file <span class="icode">config.txt</span> is with a command of the following form:
</p>
<pre class="code-sh">genet add filetype <span class="hl opt">&lt;</span>id<span class="hl opt">&gt; &lt;</span>extension<span class="hl opt">&gt; &lt;</span>description<span class="hl opt">&gt;</span></pre>
<p>Here is an example to add a new filetype with id &quot;why&quot;, extension <span class="icode">why</span>
and description &quot;why/alt-ergo file&quot;. The url identifying the filetype is printed
if the filetype is added:
</p>
<pre class="code-sh">$ genet add filetype <span class="hl str">&quot;why&quot;</span>  why <span class="hl str">&quot;why/alt-ergo file&quot;</span>
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>filetypes<span class="hl opt">/</span>why</pre>
<p>
You can browse the url if the web server is running (see <a href="#server">here</a>).
</p>
</div>

<div class="section"><div class="section-title" id="tools">Define tools, branches, versions, intefaces</div>
<p>
The next thing to do is to define your <i>tools</i> in the database. For each
tool you have to define <i>branches</i> and <i>versions</i>.
Then you can define <i>interfaces</i>. An interface has input ports and output ports and
performs a treatment. This treatment is done by a command associated to the interface.
When treatment chains will be executed, the command will take as argument the list
of inputs and output data, matching the ports.
</p>
All these operations are performed with the <span class="icode">genet</span> tool. Then the url of
the created element is printed:
<dl>
<dt>Adding a tool:</dt>
<dd><span class="icode">genet add tool &lt;id&gt;</span>
<pre class="code-sh">$ genet add tool why3
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3</pre>
</dd>

<dt>Adding a branch to a tool or branch:</dt>
<dd><span class="icode">genet add branch &lt;url of tool or branch&gt; &lt;id&gt;</span>
<pre class="code-sh">$ genet add branch http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3 <span class="hl num">0</span>.x
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>branches<span class="hl opt">/</span><span class="hl num">0</span>.x</pre>
</dd>

<dt>Adding a version to a tool or branch:</dt>
<dd><span class="icode">genet add version &lt;url of tool or branch&gt; &lt;id&gt;</span>
<pre class="code-sh">$ genet add version http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>branches<span class="hl opt">/</span><span class="hl num">0</span>.x <span class="hl num">0.1</span>
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>versions<span class="hl opt">/</span><span class="hl num">0.1</span></pre>
</dd>

<dt>Add an interface to a tool or branch:</dt>
<dd><span class="icode">genet add interface -p &lt;command path&gt; &lt;url of tool or branch&gt; &lt;id&gt;</span>
<pre class="code-sh">$ genet add interface <span class="hl opt">-</span>p <span class="hl str">&quot;/opt/why3-%v/bin/why3_split.sh&quot;</span> \
  http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>branches<span class="hl opt">/</span><span class="hl num">0</span>.x <span class="hl kwc">split</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl opt">-</span>altergo
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>interfaces<span class="hl opt">/</span><span class="hl kwc">split</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl opt">-</span>altergo</pre>
The <span class="icode">%v</span> in the command path will be replaced by a version id of the tool
when the command is executed.
</dd>

<dt>Adding a port to an interface:</dt>
<dd><span class="icode">genet add port &lt;url of interface&gt; &lt;in|out&gt; &lt;filetype id&gt;</span>
<pre class="code-sh">$ genet add port http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>interfaces<span class="hl opt">/</span><span class="hl kwc">split</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl opt">-</span>altergo <span class="hl kwa">in</span> why
http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>tools<span class="hl opt">/</span>why3<span class="hl opt">/</span>interfaces<span class="hl opt">/</span><span class="hl kwc">split</span><span class="hl opt">-</span><span class="hl num">2</span><span class="hl opt">-</span>altergo<span class="hl opt">/</span><span class="hl kwa">in</span><span class="hl opt">/</span><span class="hl num">1</span></pre>
<span class="icode">in</span> creates an input port, <span class="icode">out</span> creates an output port.
The <span class="icode">-p n</span> option can be specified to insert the port at a given (1-based) position.
Default is to append the new port.
</dd>
</dl>
<p>
Now that some elements were created in the database you may use the web interface
to have a look at them.
</p>
</div>

<div class="section"><div class="section-title" id="chains">Define treatment chains</div>
<p>
The next step is to define treatment chains. These chains define a flow of data,
based on commands (interfaces) consuming and producing files.
</p>
<p>
A chain is defined in a module, and a module is just a file in the
<span class="icode">&lt;project-root&gt;/in/chains</span> directory, with extension <span class="icode">.gnt</span>.
</p>
<p>
Here is the syntax to define a chain:
</p>
<pre class="code-genet"><span class="hl kwa">chain</span> <span class="hl opt">&lt;</span>id<span class="hl opt">&gt;</span>
<span class="hl com">(* mandatory description of the chain *)</span>
<span class="hl opt">{</span>
  <span class="hl com">(* definition of input and output ports *)</span>
  <span class="hl kwb">in</span><span class="hl opt">: &lt;</span>filetype id<span class="hl opt">&gt; &lt;</span>id of input port <span class="hl num">1</span><span class="hl opt">&gt;[, &lt;</span>filetype id<span class="hl opt">&gt; &lt;</span>id of input port <span class="hl num">2</span><span class="hl opt">&gt;[, ...]] ;</span>
  <span class="hl kwb">out</span><span class="hl opt">: &lt;</span>filetype id<span class="hl opt">&gt; &lt;</span>id of output port <span class="hl num">1</span><span class="hl opt">&gt;[, &lt;</span>filetype id<span class="hl opt">&gt; &lt;</span>id of output port <span class="hl num">2</span><span class="hl opt">&gt;[, ...]] ;</span>

  <span class="hl com">(* definition of operations *)</span>
  <span class="hl kwb">operation</span> <span class="hl opt">&lt;</span>id<span class="hl opt">&gt; : &lt;</span> <span class="hl str">&quot;&lt;tool id&gt;/&lt;interface id&gt;&quot;</span> | <span class="hl opt">&lt;</span><span class="hl kwd">Module_id</span><span class="hl opt">&gt;.&lt;</span>chain_id<span class="hl opt">&gt; &gt; ;</span>
  <span class="hl kwb">operation</span> <span class="hl opt">... ;</span>

  <span class="hl com">(* edges between</span>
<span class="hl com">    - chain input port id and operation input port number, or</span>
<span class="hl com">    - operation output port number and this chain output port id, or</span>
<span class="hl com">    - operation output port number and another operation input port number.</span>
<span class="hl com">  *)</span>
  <span class="hl opt">&lt;</span>port id<span class="hl opt">&gt; -&gt; &lt;</span><span class="hl kwb">operation</span> id<span class="hl opt">&gt;.&lt;</span>port number<span class="hl opt">&gt; ;</span>
  <span class="hl opt">&lt;</span><span class="hl kwb">operation</span> id<span class="hl opt">&gt;.&lt;</span>port number<span class="hl opt">&gt; -&gt; &lt;</span>port id<span class="hl opt">&gt; ;</span>
  <span class="hl opt">&lt;</span><span class="hl kwb">operation</span> id<span class="hl opt">&gt;.&lt;</span>port number<span class="hl opt">&gt; -&gt; &lt;</span><span class="hl kwb">operation</span> id<span class="hl opt">&gt;.&lt;</span>port number<span class="hl opt">&gt; ;</span>
  <span class="hl opt">...</span>
<span class="hl opt">}</span></pre>
<p>
<a href="http://zoggy.github.io/genet/chain_example.html">Here</a> is a complete example of a chain module.
</p>
<p>A chain module can define various chains. Each chain can be referenced by its absolute
name; for example the chain <span class="icode">foo</span> in module <span class="icode">Mod</span> can be referenced
by <span class="icode">Mod.foo</span>. This allows a modular definition of chains, to share
simple chains between more complex chains.
</p>
<p>As other elements, you can browse your chains in the web interface.</p>
</div>

<div class="section"><div class="section-title" id="inputs">Define inputs</div>
<p>An input is a file defining a list of input files and a list of chains whose
instances will be executed using these files as input.
</p>
<p>Each input is defined in a subdirectory of the <span class="icode">&lt;project-root&gt;/in/data</span> directory.
The file <span class="icode">spec.in</span> defines the list of input files, in this directory, and the list
of chains to apply on these files.
</p>
<p>For example, let's define a <span class="icode">test1</span> input by adding a
<span class="icode">&lt;project-root&gt;/in/data/test1/spec.in</span> file with the following contents:
</p>
<pre class="code-ocaml"><span class="hl com">(* Input files and directories; order matters *)</span>
<span class="hl kwa">in</span> <span class="hl opt">= [</span><span class="hl str">&quot;foo.v&quot;</span> <span class="hl opt">;</span> <span class="hl str">&quot;bar.ml&quot;</span> <span class="hl opt">]</span>
<span class="hl com">(* The chains to apply *)</span>
chains <span class="hl opt">= [</span> <span class="hl str">&quot;Mod1.my_chain&quot;</span> <span class="hl opt">;</span> <span class="hl str">&quot;Mod2.other_chain&quot;</span> <span class="hl opt">]</span></pre>.
<p>The <span class="icode">test1</span> input uses two files <span class="icode">foo.v</span>
and <span class="icode">bar.ml</span> which must be present in the <span class="icode">in/data/test1</span>
directory:
</p>
<pre class="code-sh">$ <span class="hl kwc">ls</span> <span class="hl kwa">in</span><span class="hl opt">/</span>data<span class="hl opt">/</span>test1
bar.ml  foo.v  spec.<span class="hl kwa">in</span></pre>
</div>

<div class="section"><div class="section-title" id="flattening">Flatten chains</div>
<p>
To be applied, a chain has to be flattened first, that is a &quot;flat&quot; data flow is computed
from the chain specification. A flat chain contains only calls to interfaces and no more
calls to other chains. The flat chain obtained is then stored with a unique id and remains
associated to the version ids of the source files used in the chain definition.
</p>
<p>
The following command will flatten the current versions of the chains
<span class="icode">Mod1.my_chain</span> and <span class="icode">Mod1.my_chain2</span>:
</p>
<pre class="code-sh">$ genet flatten Mod1.my_chain Mod1.my_chain2
Mod1.my_chain <span class="hl opt">=&gt;</span> http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>flat<span class="hl opt">-</span>chains<span class="hl opt">/</span>Mod1<span class="hl opt">/</span>my_chain<span class="hl opt">/</span>c4be<span class="hl opt">-</span>fc5d<span class="hl opt">-</span>d901<span class="hl opt">-</span>a047
Mod1.my_chain2 <span class="hl opt">=&gt;</span> http<span class="hl opt">://</span>localhost<span class="hl opt">:</span><span class="hl num">8082</span><span class="hl opt">/</span>flat<span class="hl opt">-</span>chains<span class="hl opt">/</span>Mod1<span class="hl opt">/</span>my_chain2<span class="hl opt">/</span>d2fe<span class="hl opt">-</span>c10d<span class="hl opt">-</span>d231<span class="hl opt">-</span>f98f</pre>
<p>
If any source file used by a chain is not commited, then the flat chain is not kept.
It is useful to test before commiting.
</p>
</div>

<div class="section"><div class="section-title" id="executing">Execute chains</div>
<p>
The <span class="icode">genet exec</span> subcommand &quot;executes&quot; an input, that is it applies available
flat chains on the input files, according to the list of chains specified in the
<span class="icode">spec.in</span> file of the input (see <a href="#inputs">this section</a>).
</p>
<p>For example, with the <span class="icode">test1</span> input as defined above, the following
command will run the chains <span class="icode">Mod1.my_chain</span> and <span class="icode">Mod2.other_chain</span>.
To do so, it will use <b>the last flattened chain</b> (according to its flattening date)
for each specified chain name:
</p>
<pre class="code-sh">$ genet <span class="hl kwb">exec</span> test1</pre>
<p>
The two executions of the two chains can now be browsed in the web interface.
</p>
</div>






</div>

<footer id="bottombar">
</footer>
<script src="http://zoggy.github.io/genet/jquery.js" type="text/javascript">_</script>
<script src="http://zoggy.github.io/genet/bootstrap-collapse.js" type="text/javascript">_</script>

</body>
</html>